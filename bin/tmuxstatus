#!/bin/sh

my_date() {
    date +'%D %I:%M %p'
}


battery() {
    if uname | grep -q "Darwin"; then
	pmset -g batt | awk '/discharging/ { if ( length($3) == 4 ) { print " B:"substr($3, 0, 2)"% " } else { print " B:"substr( $3, 0, 3 )"% " }}'
	return
    else

	if [[ -d /sys/class/power_supply/BAT1 ]]; then
	    bat_level=$( cat /sys/class/power_supply/BAT1/capacity )
	    bat_stat=$( cat /sys/class/power_supply/BAT1/status )
	else
	    bat_level=$( cat /sys/class/power_supply/BAT0/capacity )
	    bat_stat=$( cat /sys/class/power_supply/BAT0/status )
	fi
	echo " B:$bat_level "
	return
    fi
    echo ''
}

updates() {
    if uname | grep -q "Darwin"; then
	updates=$( brew outdated | wc -l | awk '/[0-9]/ {print $1}' )
	if test $updates -gt 0; then
	    echo "$updates"
	    return
	fi
    else

	echo " U: $(cat $HOME/.cache/updates | wc -l) + $(cat $HOME/.cache/aur | wc -l ) "
	return
    fi
    echo ''

}
my_mail() {
    mail=$( ls ~/.config/mail/Inbox/new | wc -l| awk '/[0-9]/ {print $1}' )
    if test $mail -gt 0; then
	echo " M: $mail "
    fi
}
echo "$(my_date)$(battery)$(updates)$(my_mail)"
