#!/bin/sh

my_date() {
    date +"%a %d/%m/%Y %I:%M %p"
}

battery() {
    if uname | grep -q "Darwin"; then
        pmset -g batt | awk '/discharging/ { if ( length($3) == 4 ) { print " B:"substr($3, 0, 2)"% " } else { print " B:"substr( $3, 0, 3 )"% " }}'
        return
    else

        if test -d /sys/class/power_supply/BAT1; then
            bat_level=$( cat /sys/class/power_supply/BAT1/capacity )
        else
            bat_level=$( cat /sys/class/power_supply/BAT0/capacity )
        fi
        echo " B:$bat_level "
        return
    fi
    echo ''
}

updates() {
    if uname | grep -q "Darwin"; then
        updates=$( brew outdated | wc -l | awk '/[0-9]/ {print $1}' )
        if test "$updates" -gt 0; then
            echo "$updates"
            return
        fi
    else
        if test $(($( wc -l < "$HOME/.cache/updates" ) +
            $( wc -l < "$HOME/.cache/aur" ))) -gt 10 ; then
            echo " U: $( wc -l < "$HOME/.cache/updates" ) + $(wc -l < "$HOME/.cache/aur" ) "
            return
        fi
    fi
    echo ''

}
my_mail() {
    mail=$( find ~/.config/mail/Inbox/new/ -type f | wc -l| awk '/[0-9]/ {print $1}' )
    if test "$mail" -gt 0; then
        echo " M: $mail "
    fi
}
echo "$(my_date)$(battery)$(updates)$(my_mail)"
